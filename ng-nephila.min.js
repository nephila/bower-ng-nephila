/*!
 * ngNephila
 * v0.0.1
 * Copyright 2015 Nephila http://nephila.it/
 * See LICENSE in this repository for license information
 */
!function(){angular.module("ngNephila",["ngNephila.filters","ngNephila.services","ngNephila.components"]),angular.module("ngNephila.filters",["ngNephila.filters.range","ngNephila.filters.titlecase","ngNephila.filters.stripHtml"]),angular.module("ngNephila.filters.range",[]).filter("range",function(){return function(e,n,i){var t=[],a=!0;if(1>i)throw new Error("Step parameter must be >= 1");if(i=void 0===i||null===i?1:i,(void 0===n||null===n)&&(n=e,e=0),e>n){var r=n;n=e,e=r,a=!1}for(var l=e;n>l;l+=i)a?t.push(l):t.unshift(l);return t}}),angular.module("ngNephila.filters.stripHtml",[]).filter("stripHtml",function(){return function(e){return e?String(e).replace(/<[^>]+>/gm,""):""}}),angular.module("ngNephila.filters.titlecase",[]).filter("titlecase",function(){return function(e,n){e=void 0===e||null===e?"":e,n=void 0===n||null===n?!1:n;var i=/\b([a-z])/g;return n&&(i=/\b([a-z])/),e.toString().toLowerCase().replace(i,function(e){return e.toUpperCase()})}}),angular.module("ngNephila.services.debounce",[]).factory("debounce",["$timeout","$q",function(e,n){return function(i,t,a){var r,l=n.defer();return function(){var o=this,s=arguments,c=function(){r=null,a||(l.resolve(i.apply(o,s)),l=n.defer())},p=a&&!r;return r&&e.cancel(r),r=e(c,t),p&&(l.resolve(i.apply(o,s)),l=n.defer()),l.promise}}}]),angular.module("ngNephila.services",["ngNephila.services.pagination","ngNephila.services.debounce","ngNephila.services.scrolledInContainer","ngNephila.services.tts"]),angular.module("ngNephila.services.pagination",[]).provider("pagination",function(){function e(){this.getPaginator=function(){return new n}}function n(){var e,n=function(e){},t=1;this.onPageChange=function(e){n=e},this.getCurrentPage=function(){return t},this.goToPage=function(e){if(1>e||e>this.getNumberOfPages())throw new Error("Wrong page to go to");t=e,n(e)},this.next=function(){t+1<=this.getNumberOfPages()&&t++,n(t)},this.prev=function(){t-1>0&&t--,n(t)},this.setNumberOfItems=function(n){return e=n},this.getNumberOfPages=function(){return Math.ceil(e/i)}}var i=0;this.setItemsPerPage=function(e){i=e},this.$get=function(){return new e}}),angular.module("ngNephila.services.scrolledInContainer",[]).factory("scrolledInContainer",function(){return function(e,n){var i=e.getBoundingClientRect(),t=(!e.style.opacity||e.style.opacity>0)&&"none"!==e.style.display&&"hidden"!==e.style.visibility;if(!t)return!1;if(!n.getBoundingClientRect)return i.top>=0&&i.bottom<=n.innerHeight;var a=n.getBoundingClientRect();return i.bottom<=a.bottom}}),angular.module("ngNephila.services.tts",[]).factory("tts",["$q",function(e){var n,i,t=!1,a=!1;return responsiveVoice.OnVoiceReady=function(){t===!1&&(void 0!==n&&n.call(),t=!0)},{isReady:function(){return t},onVoiceReady:function(e){n=e},stop:function(){a&&(i&&i.resolve(),responsiveVoice.cancel(),a=!1)},speak:function(n,t,r){a&&this.stop(),i=e.defer(),void 0===t&&(t="UK English Male"),void 0===r&&(r={}),r.onstart=function(){a=!0},r.onend=function(){a&&i&&i.resolve()};try{responsiveVoice.speak(n,t,r)}catch(l){i.reject(l)}return i.promise}}}]),angular.module("ngNephila.components.datePicker",["ngNephila.tpls.datepicker.datepicker"]).directive("datePicker",["$document",function(e){return{restrict:"E",scope:{ngModel:"="},link:function(n,i,t){n.viewFormat=t.viewFormat||"DD MMMM YYYY",n.locale=t.locale||"en",n.firstWeekDaySunday=n.$eval(t.firstWeekDaySunday)||!1,n.placeholder=t.placeholder||"",n.calendarOpened=!1,n.days=[],n.dayNames=[],n.viewValue=null,n.dateValue=null,moment.locale(n.locale);var a=moment(n.ngModel);n.viewValue=a.format(n.viewFormat);var r=function(e){var i=e.endOf("month").date(),t=e.month(),a=e.year(),r=1,l=n.firstWeekDaySunday===!0?e.set("date",2).day():e.set("date",1).day();1!==l&&(r-=l-1),n.dateValue=e.format("MMMM YYYY"),n.days=[];for(var o=r;i>=o;o+=1)o>0?n.days.push({day:o,month:t+1,year:a,enabled:!0}):n.days.push({day:null,month:null,year:null,enabled:!1})},l=function(){for(var e=n.firstWeekDaySunday===!0?moment("2015-06-07"):moment("2015-06-01"),i=0;7>i;i+=1)n.dayNames.push(e.format("ddd")),e.add("1","d")};l(),n.showCalendar=function(){n.calendarOpened=!0,r(a)},n.closeCalendar=function(){n.calendarOpened=!1},n.prevYear=function(){a.subtract(1,"Y"),r(a)},n.prevMonth=function(){a.subtract(1,"M"),r(a)},n.nextMonth=function(){a.add(1,"M"),r(a)},n.nextYear=function(){a.add(1,"Y"),r(a)},n.selectDate=function(e,i){e.preventDefault();var t=moment(i.day+"."+i.month+"."+i.year,"DD.MM.YYYY");n.ngModel=t.toDate(),n.viewValue=t.format(n.viewFormat),n.closeCalendar()};var o=["datepicker","datepicker-input"];void 0!==t.id&&o.push(t.id),e.on("click",function(e){if(n.calendarOpened){var i,t=0;if(e.target){for(i=e.target;i;i=i.parentNode){var a=i.id,r=i.className;if(void 0!==a)for(t=0;t<o.length;t+=1)if(a.indexOf(o[t])>-1||r.indexOf(o[t])>-1)return}n.closeCalendar(),n.$apply()}}})},templateUrl:function(e,n){return n.templateUrl||"template/datepicker/datepicker.html"}}}]),angular.module("ngNephila.components.fallbackImg",[]).directive("fallbackImg",function(){return{link:function(e,n,i){n.bind("error",function(){angular.element(this).attr("src",i.fallbackImg)})}}}),angular.module("ngNephila.components.infinitescroll",["ngNephila.services.scrolledInContainer"]).directive("infiniteScroll",["$window","$rootScope","scrolledInContainer",function(e,n,i){return{restrict:"E",scope:{scrollContainer:"=",onInfinite:"&",ngIf:"&"},link:function(t,a,r){var l,o=!1,s=angular.element(e),c=null,p=function(){t.ngIf()!==!1&&(l=i(a[0],c[0]),l&&!o?(o=!0,t.$$phase||n.$$phase?t.onInfinite():t.$apply(t.onInfinite)):!l&&o&&(o=!1))},g=function(e){return null!=c&&c.unbind("scroll",p),c=e,null!=e?c.bind("scroll",p):void 0};g(t.scrollContainer?angular.element(t.scrollContainer):s),p()}}}]),angular.module("ngNephila.components.modal",["ngNephila.tpls.modal.modal"]).directive("modal",function(){return{restrict:"E",scope:{show:"="},transclude:!0,link:function(e,n,i,t){e.dialogStyle={},e.hideModal=function(){e.show=!1}},templateUrl:function(e,n){return n.templateUrl||"template/modal/modal.html"}}}),angular.module("ngNephila.components",["ngNephila.components.infinitescroll","ngNephila.components.fallbackImg","ngNephila.components.paginator","ngNephila.components.toggle","ngNephila.components.datePicker","ngNephila.components.modal"]),angular.module("ngNephila.components.paginator",["ngNephila.services.pagination","ngNephila.filters.range","ngNephila.tpls.paginator.paginator"]).directive("paginator",["$filter","pagination",function(e,n){return{restrict:"E",scope:{onPageChange:"&",numberOfItems:"=",start:"=",compress:"@",prevLabel:"@",nextLabel:"@",compressLabel:"@"},templateUrl:function(e,n){return n.templateUrl||"template/paginator/paginator.html"},controller:["$scope",function(i){i.pagesVisibility=[],i.paginator=n.getPaginator(),i.paginator.setNumberOfItems(parseInt(i.numberOfItems)),i.pages=e("range")(1,1+i.paginator.getNumberOfPages()),i.calculatePagesVisiblity=function(){var e=parseInt(i.compress);if(e){var n=i.paginator.getCurrentPage(),t=i.paginator.getNumberOfPages();if(t){i.pagesVisibility=new Array(t+1);var a=n-e,r=n+e,l=!1,o=!1;0>a&&(r+=-1*a,a=1);for(var s=1;t>=s;s++)i.pagesVisibility.splice(s,0,{visibility:!1,firstHide:!1}),3>s||s>t-2?i.pagesVisibility[s].visibility=!0:(a>s?i.pagesVisibility[s].visibility=!1:s>r?i.pagesVisibility[s].visibility=!1:i.pagesVisibility[s].visibility=!0,i.pagesVisibility[s].visibility===!1&&(l||(i.pagesVisibility[s].firstHide=!0,l=!0)),s==r+1&&l&&!o&&(i.pagesVisibility[s].firstHide=!0,o=!0));a-2>=1&&i.pagesVisibility[a-2].visibility===!0&&(i.pagesVisibility[a-1].visibility=!0,i.pagesVisibility[a-1].firstHide=!1),t>r+2&&i.pagesVisibility[r+2].visibility===!0&&(i.pagesVisibility[r+1].visibility=!0,i.pagesVisibility[r+1].firstHide=!1)}}},i.canHide=function(e){return i.pagesVisibility.length?!i.pagesVisibility[e].visibility&&!i.pagesVisibility[e].firstHide:!1},i.isFirstCanHide=function(e){return i.pagesVisibility.length?i.pagesVisibility[e].firstHide:!1},i.paginator.onPageChange(function(e){i.onPageChange({page:e}),i.calculatePagesVisiblity()}),i.paginator.goToPage(parseInt(i.start))}],link:function(n,i,t){n.$watch("numberOfItems",function(i,t){n.paginator.setNumberOfItems(parseInt(i)),n.pages=e("range")(1,1+n.paginator.getNumberOfPages()),n.calculatePagesVisiblity()})}}}]),angular.module("ngNephila.components.toggle",[]).directive("toggle",["$rootScope",function(e){return{scope:{state:"="},link:function(n,i,t){var a=t.toggleClass,r=function(){n.state=!n.state};a||(a="active"),n.state?i.addClass(a):i.removeClass(a),i.bind("click",function(){i.toggleClass(a),n.$$phase||e.$$phase?n.toggleState():n.$apply(r)})}}}]),function(e){try{e=angular.module("ngNephila.tpls.datepicker.datepicker")}catch(n){e=angular.module("ngNephila.tpls.datepicker.datepicker",[])}e.run(["$templateCache",function(e){e.put("template/datepicker/datepicker.html",'<input type="text" ng-focus="showCalendar()" ng-value="viewValue" class="datepicker-input"placeholder="{{ placeholder }}"/>\n<div class="datepicker" ng-show="calendarOpened">\n  <div class="datepicker-controls">\n    <div class="datepicker-previous">\n      <i class="datepicker-prev-year" ng-click="prevYear()"></i>\n      <i class="datepicker-prev-month" ng-click="prevMonth()"></i>\n    </div>\n    <span class="datepicker-date" ng-bind="dateValue"></span>\n    <div class="datepicker-next">\n      <i class="datepicker-next-month" ng-click="nextMonth()"></i>\n      <i class="datepicker-next-year" ng-click="nextYear()"></i>\n    </div>\n  </div>\n  <div class="datepicker-day-names">\n    <span ng-repeat="dn in dayNames">\n      {{ dn }}\n    </span>\n  </div>\n  <div class="datepicker-calendar">\n    <span ng-repeat="d in days" class="datepicker-day" ng-click="selectDate($event, d)" ng-class="{disabled: !d.enabled}">\n      {{ d.day }}\n    </span>\n  </div>\n</div>')}])}(),function(e){try{e=angular.module("ngNephila.tpls.modal.modal")}catch(n){e=angular.module("ngNephila.tpls.modal.modal",[])}e.run(["$templateCache",function(e){e.put("template/modal/modal.html",'<div class="overlay" ng-show="show" ng-click="hideModal();">\n  <div class="overlay-content">\n    <div class="modal" ng-transclude ng-click="$event.stopPropagation();">\n    </div>\n  </div>\n</div>')}])}(),function(e){try{e=angular.module("ngNephila.tpls.paginator.paginator")}catch(n){e=angular.module("ngNephila.tpls.paginator.paginator",[])}e.run(["$templateCache",function(e){e.put("template/paginator/paginator.html",'<ul>\n  <li>\n    <a href="" ng-click="paginator.prev()">{{prevLabel || "&lt;&lt;"}}</a>\n  </li>\n  <li ng-hide="canHide(i)" ng-class="{active: i == paginator.getCurrentPage()}" ng-repeat="i in pages">\n    <a href="" ng-hide="isFirstCanHide(i)" ng-click="paginator.goToPage(i)">{{i}}</a>\n    <span ng-show="isFirstCanHide(i)">{{compressLabel || "..."}}</span>\n  </li>\n  <li>\n    <a href="" ng-click="paginator.next()">{{nextLabel || "&gt;&gt;"}}</a>\n  </li>\n</ul>')}])}()}();